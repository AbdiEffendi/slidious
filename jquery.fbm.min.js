/**
 * @file
 * jQuery FlyByMenu
 *
 * @author Christian Hanne <mail@christianhanne.de>
 * @url www.christianhanne.de
 */
(function(e){"use strict";e.fn.fbm=function(t,n,r){var i=this,s=null,o=0,u=0,a={},f={wrapper:"",autoScan:true,preLoad:"linked",anispeed:500,initUrl:"",hideMenu:true,links:[],onInit:function(){},onEnter:function(){},onLeave:function(){},onLoad:function(){}};a.init=function(){f=e.extend(f,t);if(e("#fbm").size()===0){e("a",i).each(function(t){if(e(this).attr("href")&&e(this).attr("data-x")&&e(this).attr("data-y")){var n={x:parseInt(e(this).attr("data-x"),10),y:parseInt(e(this).attr("data-y"),10),url:e.trim(e(this).attr("href"))};if(f.initUrl===""&&t===0){f.initUrl=n.url}if(n.x+1>o){o=n.x+1}if(n.y+1>u){u=n.y+1}f.links.push(n)}});if(f.hideMenu===true){i.addClass("fbm-hidden")}s=e("<div>").attr("id","fbm").css({width:o*100+"%",height:u*100+"%"});e("body").append(s);for(var n in f.links){if(f.links.hasOwnProperty(n)){s.append(e("<div>").attr("id","fbm-"+f.links[n].x+"-"+f.links[n].y).addClass("fbm-element").data(f.links[n]).css({width:100/o+"%",height:100/u+"%",left:f.links[n].x*(100/o)+"%",top:f.links[n].y*(100/u)+"%"}).append(e("<div>").addClass("fbm-content")))}}f.onInit(i,f);if(f.preLoad==="all"){a.preloadElements(f.links)}a.gotoUrl(f.initUrl)}};a.getElementByUrl=function(t){var n=null;t=e.trim(t)||"";for(var r in f.links){if(f.links.hasOwnProperty(r)){if(t===f.links[r].url){n=e.extend({},f.links[r]);break}}}return n};a.getElementByPosition=function(t,n){var r=null;for(var i in f.links){if(f.links.hasOwnProperty(i)){if(t===f.links[i].x&&n===f.links[i].y){r=e.extend({},f.links[i]);break}}}return r};a.gotoUrl=function(e){var t=a.getElementByUrl(e)||false;if(t){a.gotoElement(t)}};a.gotoElement=function(t){var n=e("#fbm-"+t.x+"-"+t.y),r=e(".fbm-active");if(n.hasClass("fbm-loaded")){f.onLeave(i,r,n);r.removeClass("fbm-active");s.animate({top:-1*t.y*100+"%",left:-1*t.x*100+"%"},f.speed,function(){f.onEnter(i,r,n);n.addClass("fbm-active")})}else{a.preloadElements([t],t)}};a.preloadElements=function(t,n){var r=e(".fbm-active");n=n||{};for(var s in t){if(t.hasOwnProperty(s)){var o=e("#fbm-"+t[s].x+"-"+t[s].y);if(!o.hasClass("fbm-loading")&&!o.hasClass("fbm-loaded")){o.addClass("fbm-loading");e.get(t[s].url,function(o){var u=[],l=e("<div>").html(o),c=e("#fbm-"+t[s].x+"-"+t[s].y);if(f.wrapper){l=l.find(f.wrapper)}l.appendTo(c.find(".fbm-content"));c.removeClass("fbm-loading").addClass("fbm-loaded");if(f.autoScan===true){c.find("a").not(".fbm-scanned").click(function(t){var n=a.getElementByUrl(e(this).attr("href"));if(n!==null){a.gotoElement(n);t.preventDefault()}}).each(function(){e(this).addClass("fbm-scanned");var t=a.getElementByUrl(e(this).attr("href"));if(t!==null){u.push(t)}});if(f.preLoad==="linked"){a.preloadElements(u)}}f.onLoad(i,r,c);if(n.x===t[s].x&&n.y===t[s].y){a.gotoElement(t[s])}},"html")}}}};switch(t){case"islocal":return a.getElementByUrl(n)!==null;case"goto":var l=null;if(n&&r){l=a.getElementByPosition(n,r)}else if(n){l=a.getElementByUrl(n)}if(l!==null){a.gotoElement(l)}break;default:a.init()}return i}})(jQuery)